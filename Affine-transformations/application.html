<style> body { background-color:#ccc; } </style>

<script src="//cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.7/p5.js"></script>

<body>




<!-- <form>

  X:<br>

  <input type="text" name="X"><br>

  Y:<br>

  <input type="text" name="Y"><br>

  Angle:<br>

  <input type="text" name="Angle">

</form><br> -->


<button onclick="show()">Show</button>

<button onclick="reset()">Reset</button>

<button onclick="apply()">Apply</button>

<button onclick="change()">Change</button><br><br>


<div id="matrices"></div>

<div id="inputs"></div>

<div id="consequentMatrices"></div><br><br>


<script type="text/javascript">

var imgA;

var imgB; 

var vec;

var currentMatrix = makeIdentity();

var consequentMatrices = [];

function setup() {

    createCanvas(512,512);

    background(255);  

    imgA = createImage(512,512);

    imgB = createImage(512,512);

    imgA.loadPixels();

    imgB.loadPixels();

    var d = pixelDensity();

    for(var i=0; i<512*512*4*d; i+=4) {

      imgA.pixels[i]=240;

      imgA.pixels[i+1]=250;

      imgA.pixels[i+2]=240;

      imgA.pixels[i+3]=255;

      

      imgB.pixels[i]=240;

      imgB.pixels[i+1]=240;

      imgB.pixels[i+2]=250;

      imgB.pixels[i+3]=255;

    }

    imgA.updatePixels();

    imgB.updatePixels();

    

/*     var div = document.createElement("div");

    div.setAttribute('id', "removeConsequentMatricesFlag");

    document.getElementById('consequentMatrices').appendChild(div); */

    

}


function show() {

		consequentMatrices[0] = makeIdentity();

    

    var exists = document.getElementById('removablePreFlag');

    

    if(exists){

    	document.getElementById('consequentMatrices').removeChild(exists);

    } else {

    	var pre = document.createElement("PRE");

    pre.setAttribute('id', "removablePreFlag");

    document.getElementById('consequentMatrices').appendChild(pre);

    

    for(let i = 0; i < consequentMatrices.length; i++){

      for(let j = 0; j < consequentMatrices[i].length; j++){

      for(let s = 0; s < consequentMatrices[i][j].length; s++){

      pre.innerHTML += consequentMatrices[i][j][s]+" ";

      

    	}

      pre.innerHTML += "<br>";

    	}

      

    }

    }

    

    

    

    

    

    

    

}

function reset() {

    currentMatrix = makeIdentity();

}


function showXYFields() {


			var exists = document.getElementById('removeInputsFlag');

        

        if(exists){

        		document.getElementById('inputs').removeChild(exists);

        }else{

        		var div = document.createElement("div");

    div.setAttribute('id', "removeInputsFlag");

    document.getElementById('inputs').appendChild(div);


    var f = document.createElement("form");

    

    var iX = document.createElement("input");

		iX.setAttribute('type',"text");

		iX.setAttribute('name',"X");


		var iY = document.createElement("input");

		iY.setAttribute('type',"text");

		iY.setAttribute('name',"Y");


		f.appendChild(iX);

		f.appendChild(iY);


		document.getElementById('removeInputsFlag').appendChild(f);

        }


		

}

function showAlphaFields() {

var exists = document.getElementById('removeInputsFlag');

        

        if(exists){

        		document.getElementById('inputs').removeChild(exists);

        }else{

        	var div = document.createElement("div");

    div.setAttribute('id', "removeInputsFlag");

    document.getElementById('inputs').appendChild(div);

    

    var f = document.createElement("form");

    

    var i = document.createElement("input"); 

		i.setAttribute('type',"text");

		i.setAttribute('name',"alpha");


		f.appendChild(i);


		document.getElementById('removeInputsFlag').appendChild(f);

        }



}

function apply() {

        

        var existsMatrices = document.getElementById('removeMatricesFlag');

        var existsInputs = document.getElementById('removeInputsFlag');

        

        if(existsMatrices){

        		if(existsInputs) document.getElementById('inputs').removeChild(existsInputs);

        		document.getElementById('matrices').removeChild(existsMatrices);

        } else {

        		var div = document.createElement("div");

        		div.setAttribute('id', "removeMatricesFlag");

        		document.getElementById('matrices').appendChild(div);

        

        		var identity = document.createElement("BUTTON");

        		var translate = document.createElement("BUTTON");

        		var scale = document.createElement("BUTTON");

        		var rotation = document.createElement("BUTTON");

        		var shear = document.createElement("BUTTON");  

        

						var tShear = document.createTextNode("Rotation");        

						var tRotation = document.createTextNode("Rotation");

						var tScale = document.createTextNode("Scale");        

						var tTranslate = document.createTextNode("Translate");

						var tIdentity = document.createTextNode("Identity");

            

            identity.setAttribute('onclick', "");

            translate.setAttribute('onclick', "showXYFields()");

            scale.setAttribute('onclick', "showXYFields()");

            rotation.setAttribute('onclick', "showAlphaFields()");

            shear.setAttribute('onclick', "showXYFields()");

        

						identity.appendChild(tIdentity);

        		translate.appendChild(tTranslate);

        		scale.appendChild(tScale);

        		rotation.appendChild(tRotation);

        		shear.appendChild(tShear);

        

				document.getElementById('removeMatricesFlag').appendChild(identity);

        document.getElementById('removeMatricesFlag').appendChild(translate);

        document.getElementById('removeMatricesFlag').appendChild(scale);

        document.getElementById('removeMatricesFlag').appendChild(rotation);

        document.getElementById('removeMatricesFlag').appendChild(shear);

        }

        

        


        


}


// TODO

function change() {

    

}


function draw() {

    if (!keyIsDown(32)) {

      image(imgA,0,0);

      text('Image A',10,20);

    } else {

      image(imgB,0,0);

      text('Image B',10,20);

  }

}


function makeVector(x, y){

	return [x, y, 1];

}


function drawVector(img, vec){

	img.set(vec[0], vec[1], 0);

  img.updatePixels();

}


function mouseDragged(){

	vec = makeVector(mouseX, mouseY);

  

  /* / shift + rotation + scaling

  var shifted1 = matrixMultiply(makeTransform(10, 10), makeIdentity());

  var rotated1 = matrixMultiply(shifted1, makeIdentity());

  var scaled1 = matrixMultiply(rotated1, makeIdentity());

  drawVector(imgA, multiply(scaled1, vec));

  console.log(scaled1);

  // scaling + rotation + shift

  var scaled2 = matrixMultiply(makeScaling(2, 2), makeIdentity());

  var rotated2 = matrixMultiply(scaled2, makeIdentity());

  var shifted2 = matrixMultiply(rotated2, makeIdentity());

  drawVector(imgB, multiply(shifted2, vec));

  console.log(shifted2); */

  

}







function makeIdentity(){

	return [

  					[1, 0, 0],

            [0, 1, 0],

            [0, 0, 1]

         ];

}

function makeTranslate(x, y){

	return [

  					[1, 0, x],

            [0, 1, y],

            [0, 0, 1]

         ];

}

function makeScaling(x, y){

	return [

  					[x, 0, 0],

            [0, y, 0],

            [0, 0, 1]

         ];

}

function makeRotation(a){

	var rad = Math.round(a/180 * Math.PI);

	return [

  					[Math.round(Math.cos(rad)), -Math.round(Math.sin(rad)), 0],

            [Math.round(Math.sin(rad)), Math.round(Math.cos(rad)), 0],

            [0, 0, 1]

        ];

}

function makeShear(x, y){

	return [

  					[1, x, 0],

            [y, 1, 0],

            [0, 0, 1]

         ];

}





function multiply(M, v){


var w = [0, 0, 0];


for(var i = 0; i < M.length; i++){

	for(var j = 0; j < M[i].length; j++){

  	w[i] += M[i][j] * v[j];

  }

}


/* console.log(M);

console.log(v);

console.log(w);

console.log('---------');

 */

return w;


}


function matrixMultiply(A, B){


	var o = [];

  

	for(var i = 0; i < B.length; i++){

  	o[i] = multiply(A, B[i]);

  }

  

  /* console.log(o);

  console.log('----'); */

  

  return o;


}


</script>

</body>


